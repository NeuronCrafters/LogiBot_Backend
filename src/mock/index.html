<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Professor - v7 (Dados Ricos)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #1a2c5b;
            text-align: center;
            margin-bottom: 20px;
        }
        .filters-bar {
            background-color: #ffffff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label {
            font-size: 0.8em;
            color: #555;
            margin-bottom: 5px;
        }
        .filter-group select {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background-color: #fafafa;
            min-width: 160px;
        }
        .filter-group select:disabled {
            background-color: #e9ecef;
            opacity: 0.7;
            cursor: not-allowed;
        }
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
        }
        .chart-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        .chart-card h2 {
            margin-top: 0;
            font-size: 1.2em;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        .disabled-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.7); color: #888;
            display: flex; align-items: center; justify-content: center;
            text-align: center; font-style: italic; z-index: 10;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Dashboard de Análise de Desempenho</h1>

        <div class="filters-bar">
            <div class="filter-group">
                <label for="filter-level">Nível da Análise</label>
                <select id="filter-level">
                    <option value="university">Universidade</option>
                    <option value="course">Curso</option>
                    <option value="class" selected>Turma</option>
                    <option value="student">Aluno</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-university">Universidade</label>
                <select id="filter-university">
                    <option value="unifesspa">UNIFESSPA</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-course">Curso</label>
                <select id="filter-course">
                    <option value="si">Sistemas de Informação</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-class">Turma</label>
                <select id="filter-class">
                    <option value="si2025">SI2025</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-student">Aluno</label>
                <select id="filter-student">
                     <option value="joao">João</option>
                     <option value="maria">Maria</option>
                     <option value="pedro">Pedro</option>
                     <option value="ana">Ana</option>
                </select>
            </div>
        </div>

        <div class="dashboard-container">
            <div class="chart-card"><h2 id="title-chart1"></h2><div class="chart-wrapper"><canvas id="desempenhoTopicosChart"></canvas></div></div>
            <div class="chart-card"><h2 id="title-chart2"></h2><div class="chart-wrapper" id="matriz-wrapper"><canvas id="matrizDesempenhoChart"></canvas></div></div>
            <div class="chart-card"><h2 id="title-chart3"></h2><div class="chart-wrapper"><canvas id="raioXAlunoChart"></canvas></div></div>
            <div class="chart-card"><h2 id="title-chart4"></h2><div class="chart-wrapper"><canvas id="jornadaAprendizagemChart"></canvas></div></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // =================================================================
            // MOCK DATABASE HIERÁRQUICO COM DADOS RICOS
            // =================================================================
            const db = {
                unifesspa: {
                    name: "UNIFESSPA",
                    data: { // Dados simulados agregados para a universidade
                        desempenho: [{ t: "Loops", s: 45, e: 55 }, { t: "Funções", s: 60, e: 40 }, { t: "Verificações", s: 65, e: 35 }, { t: "Tipos", s: 78, e: 22 }, { t: "Variáveis", s: 88, e: 12 }],
                        jornada: { l: ["Início", "Meio", "Final"], d: [65, 72, 68] },
                        matriz: { avgP: 68, avgE: 17, students: [{ n: "Média SI", p: 70, e: 16 }, { n: "Média CC", p: 66, e: 18 }] },
                        raioX: { l: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], d: [88, 78, 65, 60, 45] }
                    },
                    si: {
                        name: "Sistemas de Informação",
                        data: { // Dados simulados agregados para o curso
                             desempenho: [{ t: "Loops", s: 35, e: 65 }, { t: "Funções", s: 50, e: 50 }, { t: "Verificações", s: 62, e: 38 }, { t: "Tipos", s: 76, e: 24 }, { t: "Variáveis", s: 86, e: 14 }],
                             jornada: { l: ["Início", "Meio", "Final"], d: [60, 69, 58] },
                             matriz: { avgP: 65, avgE: 16, students: [{ n: "Média SI2025", p: 61, e: 14 }, { n: "Média SI2024", p: 69, e: 18 }] },
                             raioX: { l: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], d: [86, 76, 62, 50, 35] }
                        },
                        si2025: {
                            name: "Turma SI2025",
                            data: { // DADOS RICOS FORNECIDOS PELO USUÁRIO
                                desempenho: [{ topic: "Loops", successPercentage: 19.5, errorPercentage: 80.5 }, { topic: "Funções", successPercentage: 34.8, errorPercentage: 65.2 }, { topic: "Verificações", successPercentage: 59.0, errorPercentage: 41.0 }, { topic: "Tipos", successPercentage: 74.2, errorPercentage: 25.8 }, { topic: "Variáveis", successPercentage: 84.7, errorPercentage: 15.3 }],
                                jornada: { labels: ["Início (1-5)", "Bloco 2 (6-10)", "Bloco 3 (11-15)", "Final (16-20)"], data: [55, 68, 62, 45] },
                                matriz: { classAverages: { avgPerformance: 60, avgEffort: 15 }, students: [{ name: "João", performance: 30, effort: 30 }, { name: "Maria", performance: 95, effort: 18 }, { name: "Pedro", performance: 20, effort: 2 }, { name: "Ana", performance: 98, effort: 7.5 }] },
                                raioX: { labels: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], data: [84.7, 74.2, 59.0, 34.8, 19.5] } // Média da turma
                            },
                            // Dados individuais para cada aluno
                            joao: { name: "João", data: { 
                                desempenho: [{t:"Loops",s:10,e:90},{t:"Funções",s:20,e:80},{t:"Verificações",s:40,e:60},{t:"Tipos",s:75,e:25},{t:"Variáveis",s:80,e:20}],
                                jornada: { l: ["Início", "Meio", "Fim"], d: [45, 30, 25] },
                                raioX: { labels: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], data: [80, 75, 40, 20, 10] } // DADO RICO FORNECIDO
                            }},
                            maria: { name: "Maria", data: { 
                                desempenho: [{t:"Loops",s:90,e:10},{t:"Funções",s:95,e:5},{t:"Verificações",s:98,e:2},{t:"Tipos",s:100,e:0},{t:"Variáveis",s:100,e:0}],
                                jornada: { l: ["Início", "Meio", "Fim"], d: [92, 95, 98] },
                                raioX: { labels: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], data: [100, 100, 98, 95, 90] }
                            }},
                             pedro: { name: "Pedro", data: { 
                                desempenho: [{t:"Loops",s:5,e:95},{t:"Funções",s:10,e:90},{t:"Verificações",s:15,e:85},{t:"Tipos",s:20,e:80},{t:"Variáveis",s:50,e:50}],
                                jornada: { l: ["Início", "Meio", "Fim"], d: [25, 18, 15] },
                                raioX: { labels: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], data: [50, 20, 15, 10, 5] }
                            }},
                             ana: { name: "Ana", data: { 
                                desempenho: [{t:"Loops",s:95,e:5},{t:"Funções",s:98,e:2},{t:"Verificações",s:100,e:0},{t:"Tipos",s:100,e:0},{t:"Variáveis",s:100,e:0}],
                                jornada: { l: ["Início", "Meio", "Fim"], d: [96, 98, 100] },
                                raioX: { labels: ["Variáveis", "Tipos", "Verificações", "Funções", "Loops"], data: [100, 100, 100, 98, 95] }
                            }},
                        }
                    }
                }
            };
            
            let charts = {};
            const filters = { level: document.getElementById('filter-level'), university: document.getElementById('filter-university'), course: document.getElementById('filter-course'), class: document.getElementById('filter-class'), student: document.getElementById('filter-student') };

            function handleFilterChange() {
                const level = filters.level.value;
                filters.university.disabled = false;
                filters.course.disabled = !['course', 'class', 'student'].includes(level);
                filters.class.disabled = !['class', 'student'].includes(level);
                filters.student.disabled = level !== 'student';
                updateDashboard();
            }

            function updateDashboard() {
                const level = filters.level.value;
                const university = db[filters.university.value];
                const course = university ? university[filters.course.value] : null;
                const class_ = course ? course[filters.class.value] : null;
                const student = class_ ? class_[filters.student.value] : null;
                let data, title;
                switch(level) {
                    case 'university': data = university.data; title = `da Universidade ${university.name}`; break;
                    case 'course': data = course.data; title = `do Curso ${course.name}`; break;
                    case 'student': data = student.data; title = `do Aluno(a) ${student.name}`; break;
                    default: data = class_.data; title = `da ${class_.name}`; break;
                }
                
                document.getElementById('title-chart1').innerText = `1. Desempenho por Tópico ${title}`;
                document.getElementById('title-chart2').innerText = `2. Matriz de Desempenho ${title}`;
                document.getElementById('title-chart3').innerText = `3. Raio-X de Proficiência ${title}`;
                document.getElementById('title-chart4').innerText = `4. Jornada de Aprendizagem ${title}`;

                createOrUpdateDesempenhoChart(data.desempenho);
                createOrUpdateJornadaChart(data.jornada);
                createOrUpdateRaioXChart(data.raioX);
                
                const matrizWrapper = document.getElementById('matriz-wrapper');
                let overlay = matrizWrapper.querySelector('.disabled-overlay');
                if (level === 'student') {
                    if (!overlay) {
                        overlay = document.createElement('div');
                        overlay.className = 'disabled-overlay';
                        overlay.innerHTML = 'Este gráfico é comparativo<br/>e não se aplica a um único aluno.';
                        matrizWrapper.prepend(overlay);
                    }
                    if(charts.matriz) { charts.matriz.destroy(); charts.matriz = null; }
                } else {
                    if (overlay) overlay.remove();
                    createOrUpdateMatrizChart(data.matriz);
                }
            }

            Object.values(filters).forEach(filter => filter.addEventListener('change', handleFilterChange));

            const chartOptions = { responsive: true, maintainAspectRatio: false, animation: { duration: 500 } };
            function createOrUpdateChart(id, config) {
                const ctx = document.getElementById(id).getContext('2d');
                if (charts[id]) charts[id].destroy();
                charts[id] = new Chart(ctx, config);
            }
            function createOrUpdateDesempenhoChart(data) {
                const chartData = data[0].topic ? data.map(i => ({ t: i.topic, s: i.successPercentage, e: i.errorPercentage })) : data;
                createOrUpdateChart('desempenhoTopicosChart', {
                    type: 'bar', data: { labels: chartData.map(i => i.t), datasets: [{ label: 'Acertos', data: chartData.map(i => i.s), backgroundColor: 'rgba(46, 204, 113, 0.8)' }, { label: 'Erros', data: chartData.map(i => i.e), backgroundColor: 'rgba(231, 76, 60, 0.8)' }] },
                    options: { ...chartOptions, indexAxis: 'y', plugins: { legend: { position: 'top' } }, scales: { x: { stacked: true, max: 100 }, y: { stacked: true } } }
                });
            }
            function createOrUpdateMatrizChart(data) {
                createOrUpdateChart('matrizDesempenhoChart', {
                    type: 'scatter', data: { datasets: [{ label: 'Alunos', data: data.students.map(s => ({ x: s.effort || s.e, y: s.performance || s.p, name: s.name || s.n })), backgroundColor: 'rgba(54, 162, 235, 0.8)', pointRadius: 8, pointHoverRadius: 12 }] },
                    options: { ...chartOptions, plugins: { tooltip: { callbacks: { label: function(c) { return `${c.raw.name}: ${c.raw.y}% acerto em ${c.raw.x} min`; } } } }, scales: { x: { title: { display: true, text: 'Esforço (Tempo)' } }, y: { beginAtZero: true, max: 100, title: { display: true, text: 'Desempenho (%)' } } } }
                });
            }
            function createOrUpdateRaioXChart(data) {
                createOrUpdateChart('raioXAlunoChart', {
                    type: 'radar', data: { labels: data.labels || data.l, datasets: [{ label: '% de Acerto', data: data.data || data.d, fill: true, backgroundColor: 'rgba(255, 99, 132, 0.2)', borderColor: 'rgb(255, 99, 132)' }] },
                    options: { ...chartOptions, scales: { r: { beginAtZero: true, max: 100 } } }
                });
            }
            function createOrUpdateJornadaChart(data) {
                createOrUpdateChart('jornadaAprendizagemChart', {
                    type: 'line', data: { labels: data.labels || data.l, datasets: [{ label: 'Taxa de Acerto Média', data: data.data || data.d, fill: true, borderColor: 'rgb(75, 192, 192)', backgroundColor: 'rgba(75, 192, 192, 0.2)', tension: 0.3 }] },
                    options: { ...chartOptions, scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'Taxa de Acerto Média (%)' } } } }
                });
            }

            handleFilterChange();
        });
    </script>

</body>
</html>